#! /bin/bash

tmpdir=$(mktemp -d)
trap "rm -rf $tmpdir" EXIT

INPUT=$(echo $1 | sed 's/\s/\\s/g')
DIR=$(dirname $(sed 's/--file\s\+\(.*\)/\1/g' ~/.ledgerrc))
DIR="${DIR/#\~/$HOME}"

echo ';; Located Transactions' > $tmpdir/tmp.ledger
echo >> $tmpdir/tmp.ledger

for file in $DIR/*.ledger; do
    awk 'BEGIN { RS="" ; ORS="\n\n" } ; tolower($0) ~ /'${INPUT}'/ { print ";; " FILENAME " ;;\n" $0 }' $file >> $tmpdir/tmp.ledger
done
original=($(awk 'BEGIN { RS="" ; ORS="\n\n" } ; { print }' $tmpdir/tmp.ledger))

vim $tmpdir/tmp.ledger
