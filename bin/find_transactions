#! /bin/sh

tmpdir=$(mktemp -d)
trap "rm -rf $tmpdir" EXIT

INPUT=$(echo $1 | sed 's/\s/\\s/g')
DIR=$(dirname $(sed 's/--file\s\+\(.*\)/\1/g' ~/.ledgerrc))
DIR="${DIR/#\~/$HOME}"
cd $DIR
echo ';; Located Transactions' > $tmpdir/tmp.ledger
echo >> $tmpdir/tmp.ledger

find . -iname '*.ledger' -not -name 'Budget.ledger' -exec cat {} + > $tmpdir/combined
sed 's/^\([0-9]\+.*\)/--\1/' $tmpdir/combined > $tmpdir/delimeted
awk 'BEGIN { RS="--" } ; /'${INPUT}'/ {print}' $tmpdir/delimeted >> $tmpdir/tmp.ledger

vim $tmpdir/tmp.ledger
